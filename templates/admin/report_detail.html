{% extends 'base.html' %}
{% block content %}
<div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center border-b border-gray-200">
            <div>
                <h3 class="text-lg leading-6 font-medium text-gray-900">
                    Manage Report #{{ report.id }}
                </h3>
                <p class="mt-1 max-w-2xl text-sm text-gray-500">
                    Location: {{ report.latitude }}, {{ report.longitude }}
                </p>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="window.print()"
                    class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                    <i class="fas fa-print mr-2"></i> Print Official Report
                </button>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                    {% if report.status == 'Resolved' %} bg-green-100 text-green-800
                    {% elif report.status == 'In Progress' %} bg-yellow-100 text-yellow-800
                    {% else %} bg-red-100 text-red-800 {% endif %}">
                    {{ report.status }}
                </span>
            </div>
        </div>

        <!-- AI Analysis Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
            <div>
                <h4 class="text-sm font-medium text-gray-500 mb-2">Submitted Evidence</h4>
                <div class="aspect-w-4 aspect-h-3 bg-gray-200 rounded-lg overflow-hidden">
                    <img src="{{ url_for('static', filename='uploads/' + report.image_path) }}"
                        class="object-cover w-full h-full" alt="Waste photo">
                </div>
            </div>

            <div class="border-l pl-0 md:pl-6 border-transparent md:border-gray-200">
                <form method="POST" enctype="multipart/form-data" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Update Status</label>
                        <select name="status"
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md border">
                            <option value="Pending" {% if report.status=='Pending' %}selected{% endif %}>Pending
                            </option>
                            <option value="In Progress" {% if report.status=='In Progress' %}selected{% endif %}>In
                                Progress</option>
                            <option value="Resolved" {% if report.status=='Resolved' %}selected{% endif %}>Resolved
                            </option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">ðŸ“¸ Upload Cleanup Proof (If
                            Resolved)</label>
                        <input type="file" name="cleanup_image"
                            class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-green-600">
                    </div>

                    <div class="pt-4">
                        <button type="submit"
                            class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            Update Report Details
                        </button>
                    </div>
                </form>

                {% if report.cleanup_image_path %}
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <h4 class="text-sm font-medium text-green-700 mb-2">âœ… Current Proof of Cleanup</h4>
                    <div class="aspect-w-16 aspect-h-9">
                        <img src="{{ url_for('static', filename='uploads/' + report.cleanup_image_path) }}"
                            class="object-cover w-full h-48 rounded-md shadow-sm border-2 border-green-500">
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
</div>

<style>
    @media print {
        body * {
            visibility: hidden;
        }

        .max-w-7xl,
        .max-w-7xl * {
            visibility: visible;
        }

        .max-w-7xl {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        /* Hide Navbar, Footer, Buttons, Forms */
        nav,
        footer,
        button,
        form,
        .bg-gray-50 {
            display: none !important;
        }

        /* Format for Paper */
        .shadow,
        .rounded-lg,
        .border-b,
        .border,
        .border-l,
        .bg-gray-50 {
            box-shadow: none !important;
            border: none !important;
            background: white !important;
        }

        img {
            max-width: 300px !important;
            border: 1px solid #ccc !important;
        }

        h3,
        p {
            font-family: 'Courier New', Courier, monospace;
            color: black !important;
        }

        h3 {
            font-size: 24pt;
            text-decoration: underline;
            margin-bottom: 20px;
        }

        /* Add Official Header & Footer */
        .max-w-7xl::before {
            content: "OFFICIAL WASTE MANAGEMENT REPORT";
            display: block;
            text-align: center;
            font-size: 20pt;
            font-weight: bold;
            margin-bottom: 30px;
            border-bottom: 2px solid black;
        }

        .max-w-7xl::after {
            content: "Authorized Signature: _________________________________________ \A \A Date: _________________";
            white-space: pre;
            display: block;
            margin-top: 50px;
            font-size: 14pt;
        }
    }
</style>
{% endblock %}